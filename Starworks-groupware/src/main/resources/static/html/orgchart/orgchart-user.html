<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ì§ë„ - Mazer Admin Dashboard</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="mazer-1.0.0/dist/assets/css/bootstrap.css">

    <link rel="stylesheet" href="mazer-1.0.0/dist/assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="mazer-1.0.0/dist/assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="mazer-1.0.0/dist/assets/css/app.css">
    <link rel="shortcut icon" href="mazer-1.0.0/dist/assets/images/favicon.svg" type="image/x-icon">
    
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <div class="logo">
                            <a href="index.html"><img src="mazer-1.0.0/dist/assets/images/logo/logo.png" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>

                        <li class="sidebar-item">
                            <a href="index.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>ëŒ€ì‹œë³´ë“œ</span>
                            </a>
                        </li>

                        <li class="sidebar-item active">
                            <a href="organization_chart_mazer_themed.html" class='sidebar-link'>
                                <i class="bi bi-diagram-3-fill"></i>
                                <span>ì¡°ì§ë„</span>
                            </a>
                        </li>

                        <li class="sidebar-item">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-file-earmark-text-fill"></i>
                                <span>ì „ìê²°ì¬</span>
                            </a>
                        </li>

                        <li class="sidebar-item">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-grid-1x2-fill"></i>
                                <span>ê²Œì‹œíŒ</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <h3>ì¡°ì§ë„</h3>
            </div>
            <div class="page-content">
                <section class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" id="orgSearchInput" class="form-control"
                                        placeholder="ë¶€ì„œëª… ë˜ëŠ” ì‚¬ì›ëª… ê²€ìƒ‰" aria-label="Search organization">
                                    <button class="btn btn-primary" type="button" id="orgSearchButton">ê²€ìƒ‰</button>
                                </div>

                                <div class="row">
                                    <!-- Organization Tree -->
                                    <div class="col-md-6">
                                        <h4>ì¡°ì§ êµ¬ì¡°</h4>
                                        <div id="orgTreeContainer" class="org-tree border p-3 rounded bg-white"
                                            style="min-height: 400px;">
                                            <!-- Org Tree will be rendered here by JS -->
                                        </div>
                                    </div>

                                    <!-- Department Detail -->
                                    <div class="col-md-6">
                                        <h4>ë¶€ì„œ ìƒì„¸ ì •ë³´</h4>
                                        <div id="deptDetailContainer" class="border p-3 rounded bg-white"
                                            style="min-height: 400px;">
                                            <p class="text-muted">ë¶€ì„œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                                            <!-- Department details and employee list will be rendered here by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2021 &copy; Mazer</p>
                    </div>
                    <div class="float-end">
                        <p>Crafted with <span class="text-danger"><i class="bi bi-heart"></i></span> by <a
                                href="http://ahmadsaugi.com">A. Saugi</a></p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Member Detail Modal -->
    <div class="modal fade" id="memberDetailModal" tabindex="-1" aria-labelledby="memberDetailModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="memberDetailModalLabel">ì‚¬ì› ì •ë³´</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="memberPhoto" src="" class="profile-img" alt="í”„ë¡œí•„ ì‚¬ì§„">
                    <h4><span id="memberName"></span> <span class="chat-icon" title="ì±„íŒ…í•˜ê¸°">ğŸ’¬</span></h4>
                    <p class="text-muted" id="memberPosition"></p>
                    <ul class="list-group list-group-flush text-start">
                        <li class="list-group-item">ğŸ“ ì „í™”ë²ˆí˜¸: <span id="memberPhone"></span></li>
                        <li class="list-group-item">ğŸ“§ ì´ë©”ì¼: <span id="memberEmail"></span></li>
                        <li class="list-group-item">ğŸ“Š ê·¼ë¬´í˜„í™©: <span id="memberStatus" class="badge"></span></li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script src="mazer-1.0.0/dist/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="mazer-1.0.0/dist/assets/js/bootstrap.bundle.min.js"></script>

    <script src="mazer-1.0.0/dist/assets/js/main.js"></script>
    <script>
        // Mock Data (copied from src/data/mockData.js)
        const mockData = [
            {
                id: 1,
                name: "CEO",
                employees: [
                    { id: 101, name: "í™ê¸¸ë™", position: "ëŒ€í‘œì´ì‚¬", phone: "010-1111-1111", email: "ceo@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" }
                ],
                subDepartments: [
                    {
                        id: 2,
                        name: "ê²½ì˜ê´€ë¦¬ë³¸ë¶€",
                        employees: [
                            { id: 201, name: "ê¹€ì˜í¬", position: "ë³¸ë¶€ì¥", phone: "010-2222-2222", email: "kim@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" }
                        ],
                        subDepartments: [
                            {
                                id: 4,
                                name: "ì¸ì‚¬íŒ€",
                                employees: [
                                    { id: 401, name: "ë°•ì² ìˆ˜", position: "íŒ€ì¥", phone: "010-4444-4444", email: "park@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" },
                                    { id: 402, name: "ì´í•˜ë‚˜", position: "ëŒ€ë¦¬", phone: "010-4444-5555", email: "lee@example.com", status: "íœ´ê°€", photo: "wh.png" }
                                ],
                                subDepartments: []
                            },
                            {
                                id: 5,
                                name: "ì´ë¬´íŒ€",
                                employees: [
                                    { id: 501, name: "ìµœë¯¼ì¤€", position: "ê³¼ì¥", phone: "010-5555-6666", email: "choi@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" }
                                ],
                                subDepartments: []
                            }
                        ]
                    },
                    {
                        id: 3,
                        name: "ê°œë°œë³¸ë¶€",
                        employees: [
                            { id: 301, name: "ì •ìˆœì´", position: "ë³¸ë¶€ì¥", phone: "010-3333-3333", email: "jung@example.com", status: "ì¶œì¥", photo: "wh.png" }
                        ],
                        subDepartments: [
                            {
                                id: 6,
                                name: "í”„ë¡ íŠ¸ì—”ë“œíŒ€",
                                employees: [
                                    { id: 601, name: "ìœ¤ì§€í›„", position: "íŒ€ì¥", phone: "010-6666-7777", email: "yoon@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" },
                                    { id: 602, name: "ì†¡ê°€ì¸", position: "ì‚¬ì›", phone: "010-6666-8888", email: "song@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" }
                                ],
                                subDepartments: []
                            },
                            {
                                id: 7,
                                name: "ë°±ì—”ë“œíŒ€",
                                employees: [
                                    { id: 701, name: "ê°•í•˜ëŠ˜", position: "íŒ€ì¥", phone: "010-7777-8888", email: "kang@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" },
                                    { id: 702, name: "ë°°ìˆ˜ì§€", position: "ëŒ€ë¦¬", phone: "010-7777-9999", email: "bae@example.com", status: "ê·¼ë¬´ì¤‘", photo: "wh.png" }
                                ],
                                subDepartments: []
                            }
                        ]
                    }
                ]
            }
        ];

        // Function to calculate total employees in a department and its sub-departments
        function getTotalEmployees(department) {
            let count = department.employees.length;
            department.subDepartments.forEach(subDept => {
                count += getTotalEmployees(subDept);
            });
            return count;
        }

        // Function to render the organization tree
        function renderOrgTree(departments, parentElement) {
            const ul = document.createElement('ul');
            departments.forEach(dept => {
                const li = document.createElement('li');
                const totalEmployees = getTotalEmployees(dept);
                const deptLink = document.createElement('a');
                deptLink.href = "#";
                deptLink.classList.add('department-name');
                deptLink.innerHTML = `<i class="bi bi-folder-fill text-primary"></i> ${dept.name} (${totalEmployees}ëª…)`;
                deptLink.dataset.deptId = dept.id; // Store department ID
                li.appendChild(deptLink);

                // Add employee list under the department
                if (dept.employees.length > 0) {
                    const empUl = document.createElement('ul');
                    empUl.classList.add('list-unstyled', 'ps-4');
                    dept.employees.forEach(emp => {
                        const empLi = document.createElement('li');
                        const empLink = document.createElement('a');
                        empLink.href = '#';
                        empLink.classList.add('employee-link', 'text-decoration-none', 'text-muted');
                        empLink.dataset.employeeId = emp.id;
                        empLink.innerHTML = `<i class="bi bi-person-fill"></i> ${emp.name} <span class="badge bg-light text-dark rounded-pill">${emp.position}</span>`;
                        empLi.appendChild(empLink);
                        empUl.appendChild(empLi);
                    });
                    li.appendChild(empUl);
                }

                if (dept.subDepartments.length > 0) {
                    renderOrgTree(dept.subDepartments, li);
                }
                ul.appendChild(li);
            });
            parentElement.appendChild(ul);
        }

        // Function to find a department by ID
        function findDepartmentById(id, departments) {
            for (const dept of departments) {
                if (dept.id === id) {
                    return dept;
                }
                const found = findDepartmentById(id, dept.subDepartments);
                if (found) {
                    return found;
                }
            }
            return null;
        }

        // Function to find an employee by ID
        function findEmployeeById(id, departments) {
            for (const dept of departments) {
                for (const emp of dept.employees) {
                    if (emp.id === id) {
                        return emp;
                    }
                }
                const found = findEmployeeById(id, dept.subDepartments);
                if (found) {
                    return found;
                }
            }
            return null;
        }

        // Function to display department details
        function displayDepartmentDetails(deptId) {
            const dept = findDepartmentById(deptId, mockData);
            const deptDetailContainer = document.getElementById('deptDetailContainer');
            deptDetailContainer.innerHTML = ''; // Clear previous content

            if (dept) {
                const totalEmployees = getTotalEmployees(dept);
                let html = `
                    <h4>${dept.name}</h4>
                    <p>ì´ ì¸ì›: ${totalEmployees}ëª…</p>
                    <h5>ë¶€ì„œì› ëª©ë¡</h5>
                    <ul class="list-group employee-list">
                `;

                function addEmployeesToList(department) {
                    department.employees.forEach(emp => {
                        html += `
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-employee-id="${emp.id}">
                                ${emp.name} <span class="badge bg-secondary rounded-pill">${emp.position}</span>
                            </li>
                        `;
                    });
                    department.subDepartments.forEach(addEmployeesToList);
                }

                addEmployeesToList(dept);

                html += `</ul>`;
                deptDetailContainer.innerHTML = html;

                // Add event listeners to employee list items
                deptDetailContainer.querySelectorAll('.employee-list .list-group-item').forEach(item => {
                    item.addEventListener('click', (event) => {
                        const empId = parseInt(event.currentTarget.dataset.employeeId);
                        displayMemberModal(empId);
                    });
                });
            } else {
                deptDetailContainer.innerHTML = '<p class="text-muted">ë¶€ì„œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
            }
        }

        // Function to display member details in modal
        function displayMemberModal(empId) {
            const employee = findEmployeeById(empId, mockData);
            if (employee) {
                document.getElementById('memberPhoto').src = employee.photo ? employee.photo : 'mazer-1.0.0/dist/assets/images/faces/1.jpg';
                document.getElementById('memberName').textContent = employee.name;
                document.getElementById('memberPosition').textContent = `ì§ê¸‰: ${employee.position}`;
                document.getElementById('memberPhone').textContent = employee.phone;
                document.getElementById('memberEmail').textContent = employee.email;

                const memberStatusSpan = document.getElementById('memberStatus');
                memberStatusSpan.textContent = employee.status;
                memberStatusSpan.className = 'badge'; // Reset classes
                if (employee.status === 'ê·¼ë¬´ì¤‘') {
                    memberStatusSpan.classList.add('bg-success');
                } else if (employee.status === 'íœ´ê°€') {
                    memberStatusSpan.classList.add('bg-warning', 'text-dark');
                } else if (employee.status === 'ì¶œì¥') {
                    memberStatusSpan.classList.add('bg-info');
                } else {
                    memberStatusSpan.classList.add('bg-secondary');
                }

                const memberModal = new bootstrap.Modal(document.getElementById('memberDetailModal'));
                memberModal.show();
            }
        }

        // Function to search organization
        function searchOrganization() {
            const searchTerm = document.getElementById('orgSearchInput').value.toLowerCase();
            const orgTreeContainer = document.getElementById('orgTreeContainer');
            orgTreeContainer.innerHTML = ''; // Clear current tree

            function filterData(departments, term) {
                const results = [];
                for (const dept of departments) {
                    const matchingEmployees = dept.employees.filter(emp => emp.name.toLowerCase().includes(term));
                    const matchingSubDepts = filterData(dept.subDepartments, term);

                    if (dept.name.toLowerCase().includes(term) || matchingEmployees.length > 0 || matchingSubDepts.length > 0) {
                        results.push({
                            ...dept,
                            employees: matchingEmployees,
                            subDepartments: matchingSubDepts
                        });
                    }
                }
                return results;
            }

            const filteredData = filterData(mockData, searchTerm);
            if (filteredData.length > 0) {
                renderOrgTree(filteredData, orgTreeContainer);
            } else {
                orgTreeContainer.innerHTML = '<p class="text-muted">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }


        // Initial rendering of the organization tree and event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const orgTreeContainer = document.getElementById('orgTreeContainer');
            renderOrgTree(mockData, orgTreeContainer);

            // Add event listener for department and employee clicks
            orgTreeContainer.addEventListener('click', (event) => {
                const deptLink = event.target.closest('.department-name');
                const empLink = event.target.closest('.employee-link');

                if (deptLink) {
                    event.preventDefault();
                    const deptId = parseInt(deptLink.dataset.deptId);
                    displayDepartmentDetails(deptId);
                } else if (empLink) {
                    event.preventDefault();
                    const empId = parseInt(empLink.dataset.employeeId);
                    displayMemberModal(empId);
                }
            });

            // Add event listener for search button
            document.getElementById('orgSearchButton').addEventListener('click', searchOrganization);
            document.getElementById('orgSearchInput').addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    searchOrganization();
                }
            });
        });
    </script>
</body>

</html>